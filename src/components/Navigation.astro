---
import NavLink from "@components/NavLink.astro";

const currentPath = Astro.url.pathname;
---

<nav aria-label="primary">
  <ul class="grid grid-cols-4 md:grid-cols-5 border-r border-dashed">
    <li class="w-full max-md:col-span-4 max-md:border-b border-dashed">
      <NavLink href="/" isActive={currentPath === "/"}> Home </NavLink>
    </li>
    <li class="w-full">
      <NavLink href="/tickets/" isActive={currentPath.startsWith("/tickets")}>
        All
      </NavLink>
    </li>
    <li class="w-full">
      <NavLink href="/theaters/" isActive={currentPath.startsWith("/theaters")}>
        Theaters
      </NavLink>
    </li>
    <li class="w-full">
      <NavLink href="/ratings/" isActive={currentPath.startsWith("/ratings")}>
        Ratings
      </NavLink>
    </li>
    <li class="w-full">
      <NavLink href="/search/" isActive={currentPath === "/search/"}>
        Search
      </NavLink>
    </li>
  </ul>
</nav>

<script>
  document.addEventListener("astro:after-swap", () => {
    const currentPath = window.location.pathname;
    const nav = document.querySelector('nav[aria-label="primary"]');
    if (!nav) return;

    const links = nav.querySelectorAll("a");
    links.forEach((link) => {
      const href = link.getAttribute("href");
      let isActive = false;

      if (href === "/") {
        isActive = currentPath === "/";
      } else if (href === "/tickets/") {
        isActive = currentPath.startsWith("/tickets");
      } else if (href === "/theaters/") {
        isActive =
          currentPath === "/theaters/" || currentPath.startsWith("/theaters/");
      } else if (href === "/ratings/") {
        isActive =
          currentPath === "/ratings/" || currentPath.startsWith("/ratings");
      } else if (href === "/search/") {
        isActive = currentPath === "/search/";
      }

      if (isActive) {
        link.setAttribute("aria-current", "page");
        link.classList.add("bg-green");
      } else {
        link.removeAttribute("aria-current");
        link.classList.remove("bg-green");
      }
    });
  });
</script>
