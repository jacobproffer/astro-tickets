---
import { getCollection } from "astro:content";
import Section from "@components/Section.astro";
import TicketGrid from "@components/TicketGrid.astro";

const tickets = await getCollection("tickets");
// Sort tickets by date in descending order (newest first)
const sortedTickets = tickets.sort((a, b) => {
  const dateA = new Date(a.data.date);
  const dateB = new Date(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

// Show only the 12 most recent tickets on the homepage
const recentTickets = sortedTickets.slice(0, 12);
const totalTickets = tickets.length;
---

<Section headline="Recent Tickets">
  <TicketGrid tickets={recentTickets} />

  <div
    class="flex justify-between items-center pb-4 mb-4 border-b border-solid"
  >
    <p>
      Showing {recentTickets.length} of {totalTickets} tickets
    </p>
    <a
      href="/tickets/"
      class="border border-solid py-3 px-4 hover:bg-gray-100 focus:outline-4 focus:outline-black focus:-outline-offset-2 transition-colors"
    >
      View All {totalTickets} Tickets
    </a>
  </div>
</Section>
