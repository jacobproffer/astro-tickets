---
import { getCollection } from "astro:content";
import Section from "./Section.astro";
import Ticket from "./Ticket.astro";
import Container from "./Container.astro";

const tickets = await getCollection("tickets");
// Sort tickets by date in descending order (newest first)
const sortedTickets = tickets.sort((a, b) => {
  const dateA = new Date(a.data.date);
  const dateB = new Date(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

// Show only the 12 most recent tickets on the homepage
const recentTickets = sortedTickets.slice(0, 12);
const totalTickets = tickets.length;
---

<Section headline="Recent Tickets">
  <ol
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 border-t border-l border-dashed border-black"
  >
    {
      recentTickets.map((ticket) => (
        <li>
          <Ticket
            title={ticket.data.title}
            theater={ticket.data.theater}
            time={ticket.data.date.toISOString().split("T")[0]}
            price={ticket.data.price}
            rating={ticket.data.rating}
          />
        </li>
      ))
    }
  </ol>

  <div class="flex justify-between items-center pb-4 border-b border-dashed">
    <p>
      Showing {recentTickets.length} of {totalTickets} tickets
    </p>
    <a href="/tickets/" class="border border-dashed py-3 px-4">
      View All {totalTickets} Tickets
    </a>
  </div>
</Section>
