---
import { getCollection } from "astro:content";
import Section from "./Section.astro";
import Ticket from "./Ticket.astro";
import Container from "./Container.astro";

const tickets = await getCollection("tickets");
// Sort tickets by date in descending order (newest first)
const sortedTickets = tickets.sort((a, b) => {
  const dateA = new Date(a.data.date);
  const dateB = new Date(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

// Show only the 12 most recent tickets on the homepage
const recentTickets = sortedTickets.slice(0, 12);
const totalTickets = tickets.length;
---

<Section headline="Recent Tickets">
  <div
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-8"
  >
    {
      recentTickets.map((ticket) => (
        <Ticket
          title={ticket.data.title}
          theater={ticket.data.theater}
          time={ticket.data.date.toISOString().split("T")[0]}
          price={ticket.data.price}
          rating={ticket.data.rating}
        />
      ))
    }
  </div>

  <Container>
    <div class="text-center">
      <p class="text-gray-400 mb-4">
        Showing {recentTickets.length} of {totalTickets} tickets
      </p>
      <a
        href="/tickets/"
        class="inline-flex items-center px-6 py-3 border border-gray-600 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition-colors"
      >
        View All {totalTickets} Tickets â†’
      </a>
    </div>
  </Container>
</Section>
