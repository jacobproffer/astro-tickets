---
import { getCollection } from "astro:content";
import BaseLayout from "@layouts/BaseLayout.astro";
import PageHeader from "@components/PageHeader.astro";
import Section from "@components/Section.astro";
import TicketGrid from "@components/TicketGrid.astro";

export async function getStaticPaths() {
  const tickets = await getCollection("tickets");

  // Get all unique theaters
  const theaters = [...new Set(tickets.map((ticket) => ticket.data.theater))];

  return theaters.map((theater) => ({
    params: { theater: theater.toLowerCase().replace(/[^a-z0-9]/g, "-") },
    props: {
      tickets: tickets.filter((ticket) => ticket.data.theater === theater),
      theater,
    },
  }));
}

const { tickets, theater } = Astro.props;
const sortedTickets = tickets.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const pageTitle = `${theater} Movies`;
const pageDescription = `Browse ${tickets.length} movie tickets from ${theater} in my collection.`;
---

<BaseLayout pageTitle={pageTitle} pageDescription={pageDescription}>
  <Section headline={`${theater} Movies (${tickets.length})`} headingLevel={1}>
    <PageHeader
      title="movies"
      count={tickets.length}
      description={`Showing all ${tickets.length} movies from ${theater}`}
    />

    <TicketGrid tickets={sortedTickets} transitionName="tickets-grid" />
  </Section>
</BaseLayout>
